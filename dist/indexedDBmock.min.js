/*! indexedDBmock 01-04-2015 */
!function(a){function b(a){if("number"==typeof a&&!isNaN(a)||"string"==typeof a||a instanceof Date&&!isNaN(a))return!0;if(a instanceof Array){for(var c=a.length-1;c>=0;c--)if(!b(a[c]))return!1;return!0}return!1}function c(a,b){if("number"==typeof a&&"number"==typeof b||"string"==typeof a&&"string"==typeof b||a instanceof Date&&b instanceof Date||a instanceof Array&&b instanceof Array){if(a instanceof Array&&b instanceof Array){a=a.sort(c),b=b.sort(c);for(var d=a.length<b.length?a.length:b.length,e=0;d>e;e++){if(a[e]<b[e])return-1;if(a[e]>b[e])return 1}return a.length<b.length?-1:a.length>b.length?1:0}return b>a?-1:a>b?1:0}return a instanceof Array?1:b instanceof Array?-1:"string"==typeof a?1:"string"==typeof b?-1:a instanceof Date?1:-1}var d=1,e={},f={open:function(a,b){var c,f={};for(var l in e)l===a&&(c=e[l]);c||(b||(b=1),c=new h(a),e[a]=c);var m=new i(c);return b&&m.version>b?setTimeout(function(){"function"==typeof f.onerror&&(f.target=f,f.target.errorCode="VersionError",f.target.error={name:"VersionError"},f.target.readyState="done",f.onerror(f))},d):b&&m.version<b?setTimeout(function(){f.target=f,f.target.readyState="done",f.target.type="upgradeneeded",f.target.newVersion=b,f.target.oldVersion=m.version,f.target.transaction=new k(null,g.VERSIONCHANGE,new j(c,m)),f.target.transaction.db.version=b,m.version=b,c.version=b,"function"==typeof f.onupgradeneeded&&(f.onupgradeneeded(f),f.target.transaction.__commit()),setTimeout(function(){f.target.transaction._aborted?"function"==typeof f.onerror&&(f.target=f,f.target.errorCode=8,f.target.error={name:"AbortError",message:"The transaction was aborted."},f.target.readyState="done",f.onerror(f)):"function"==typeof f.onsuccess&&(f.target=f,f.target.result=m,f.target.readyState="done",c.connections.push(m),f.onsuccess(f));for(var a=0;a<c.connections.length;a++)c.connections[a]._connectionId!==m._connectionId&&"function"==typeof c.connections[a].onversionchange&&(c.connections[a].target=c.connections[a],c.connections[a].target.readyState="done",c.connections[a].target.type=g.VERSIONCHANGE,c.connections[a].target.version=b,c.connections[a].onversionchange(c.connections[a]))},d)},d):setTimeout(function(){"function"==typeof f.onsuccess&&(f.target=f,f.target.result=m,f.target.readyState="done",c.connections.push(m),f.onsuccess(f))},d),f},deleteDatabase:function(a){var b={};for(var c in e)c===a&&(e[c]=void 0,delete e[c]);return setTimeout(function(){"function"==typeof b.onsuccess&&(b.target=b,b.target.readyState="done",b.onsuccess(b))},d),b},cmp:function(){}},g={READONLY:"readonly",READWRITE:"readwrite",VERSIONCHANGE:"versionchange"},h=function(a){this.name=a,this.version=0,this.objectStoreNames=[],this.objectStores=[],this.connections=[],this.transactions=[]},i=function(a){this.name=a.name,this.version=a.version,this.objectStoreNames=a.objectStoreNames,this._connectionId=a.connections.length,this._db=a},j=function(a,b){this.name=a.name,this.version=a.version,this.objectStoreNames=a.objectStoreNames,this._db=a,this._connection=b,this._objectStores=a.objectStores||[]},k=function(a,b,c){if(this.db=c,this.__active=!0,this._aborted=!1,this.__actions=[],b||(b=g.READONLY),b!==g.VERSIONCHANGE&&(!a||0===a.length))throw this.aborted=!0,this.__checkFinished(this),{name:"InvalidAccessError"};if(b!==g.READONLY&&b!==g.READWRITE&&b!==g.VERSIONCHANGE&&(b=g.READONLY),a)for(var d=0;d<a.length;d++){for(var e=!1,f=0;f<c.objectStoreNames.length;f++)c.objectStoreNames[f]===a[d]&&(e=!0);if(!e)throw this.aborted=!0,this.__checkFinished(this),{name:"NotFoundError"}}this.mode=b,this.objectStoreNames=a,this.db.transaction=this,this.__checkFinished(this)},l=function(a,b,c){this.name=a,this.keyPath=b?b.keyPath:void 0,this.autoIncrement=b?b.autoIncrement:void 0,this.indexNames=[],this.transaction=c,this._indexes=[],this.__data={},this.__keys=[],this.__actions=[],this.__latestKey=0},m=function(){},n=function(a,b,c,d){this.name=a,this.keyPath=b,this.multiEntry=c?c.multiEntry:void 0,this.unique=c?c.unique:void 0,this.objectStore=d,this.__data={}},o=function(a,b,c,d){this.lower=a,this.upper=b,this.lowerOpen=c?c:!1,this.upperOpen=d?d:!1};i.prototype=function(){function a(){for(var a=0;a<this._db.connections.length;a++)this._db.connections[a].connectionId===this._connectionId&&this._db.connections.splice(a,1)}function b(a,b){var c=new k(a,b,new j(this._db,this));return c}return{close:a,transaction:b}}(),j.prototype=function(){function a(){this._connection.close()}function b(){this._db.objectStores=this._objectStores,this._db.objectStoreNames=this.objectStoreNames}function c(a,b){return this._connection.transaction(a,b)}function d(a,b){if(this.transaction.mode!==g.VERSIONCHANGE)throw{name:"InvalidStateError"};if(b&&b.keyPath instanceof Array)for(var c=0;c<b.keyPath.length;c++)if(""===b.keyPath[c])throw this.transaction.abort(),{name:"InvalidAccessError"};var d=new l(a,b,this.transaction);return this._objectStores.push(d),this.objectStoreNames.push(a),d}function e(a){if(this.transaction.mode!==g.VERSIONCHANGE)throw{name:"InvalidStateError"};for(var b=!1,c=0;c<this.objectStoreNames.length;c++)this.objectStoreNames[c]===a&&(this.objectStoreNames.splice(c,1),b=!0);if(!b)throw{name:"NotFoundError"};for(var d=0;d<this._objectStores.length;d++)this._objectStores[d].name===a&&this._objectStores.splice(d,1)}return{close:a,transaction:c,createObjectStore:d,deleteObjectStore:e,__commit:b}}(),k.prototype=function(){function a(){for(var a=0;a<this.db._objectStores.length;a++){var b=(new Date).getTime();this.__actions.push(b),f(this,this.db._objectStores[a],b)}}function b(a){a._aborted||a.__commited||(a.__commited=!0,"readonly"!=this.mode&&a.db.__commit(),a.__active=!1,"function"==typeof a.oncomplete&&(a.target=a,a.target.result=a,a.target.readyState="done",a.oncomplete(a)))}function c(a){this._aborted=!0,a||(a={name:"AbortError",message:"The transaction was aborted."});var b=this;setTimeout(function(){"function"==typeof b.onabort&&(b.target=b,b.target.errorCode=8,b.target.error=a,b.target.readyState="done",b.onabort(b))},d)}function e(a){var b=(new Date).getTime();if(this.__actions.push(b),this.mode!==g.VERSIONCHANGE){for(var c=!1,d=0;d<this.objectStoreNames.length;d++)this.objectStoreNames[d]===a&&(c=!0);if(!c)throw this.__actions.splice(this.__actions.indexOf(b),1),f(this,void 0,b),{name:"NotFoundError"}}for(var e=0;e<this.db._objectStores.length;e++)if(this.db._objectStores[e].name===a){var h=this.db._objectStores[e];return h.transaction=this,f(this,h,b),h}throw this.__actions.splice(this.__actions.indexOf(b),1),f(this,void 0,b),{name:"NotFoundError"}}function f(a,c,e){setTimeout(function(){c?c.__finished()?(a.__actions.splice(a.__actions.indexOf(e),1),0===a.__actions.length&&b(a)):f(a,c,e):0===a.__actions.length&&b(a)},d)}return{abort:c,objectStore:e,__commit:a,__checkFinished:f}}(),l.prototype=function(){function a(a){return"Object"===a.constructor.name}function e(a){var b={};return a&&"[object Function]"===b.toString.call(a)}function f(a,b){for(var c=b.split("."),d=a,e=0;e<c.length;e++)d&&(d=d[c[e]]);return d}function h(a,b,c){for(var d=b.split("."),e=a,f=0;f<d.length;f++)f!=d.length-1?(e[d[f]]={},e=e[d[f]]):e[d[f]]=c;return e}function i(b){for(var c in b){if(e(b[c]))return!0;if(a(c)&&i(b[c]))return!0}return!1}function j(a){var b=(new Date).getTime(),e=this;e.__actions.push(b);var f,g={};if(a instanceof o||(a=o.only(a)),-1==e.transaction.db.objectStoreNames.indexOf(e.name)&&m(e,g,{name:"InvalidStateError"}),a.upper===a.lower)f=e.__data[a.lower];else for(var h=this.__keys.sort(c),i=0;i<h.length;i++)if(a.inRange(h[i])){f=e.__data[h[i]];break}return setTimeout(function(){"function"==typeof g.onsuccess&&(g.target=g,g.target.result=f,g.target.readyState="done",g.onsuccess(g)),e.__actions.splice(e.__actions.indexOf(b),1)},d),g}function k(a,b){return q(this,a,b,!1)}function l(a,b){return q(this,a,b,!0)}function m(a,b,c){return setTimeout(function(){"function"==typeof b.onerror&&(b.target=b,b.target.readyState="done",b.target.error=c,b.onerror(b)),"function"==typeof a.transaction.onerror&&(a.transaction.target=a.transaction,a.transaction.target.readyState="done",a.transaction.target.error=c,a.transaction.onerror(a.transaction)),a.transaction.abort(c)},d),b}function p(a,b,c){throw c&&a.__actions.splice(a.__actions.indexOf(c),1),b}function q(c,e,j,k){var l=(new Date).getTime();c.__actions.push(l);var n={},o=j;if(-1==c.transaction.db.objectStoreNames.indexOf(c.name)&&p(c,{name:"InvalidStateError"},l),c.transaction.mode==g.READONLY&&p(c,{name:"ReadOnlyError"},l),(!c.keyPath&&!j&&!c.autoIncrement||c.keyPath&&(j||!e[c.keyPath]&&!c.autoIncrement||!a(e)))&&p(c,{name:"DataError"},l),c.autoIncrement){if(o&&"number"==typeof o&&o>c.__latestKey||(o=c.__latestKey+1,c.keyPath&&h(e,c.keyPath,o)),o>9007199254740992)return m(c,n,{name:"ConstraintError"});c.__latestKey=o}else c.keyPath&&(o=f(e,c.keyPath));if(b(o)||p(c,{name:"DataError"},l),k&&c.__data[o])return m(c,n,{name:"ConstraintError"});i(e)&&p(c,{name:"DataCloneError"},l);for(var q=0;q<c._indexes.length;q++){var r=c._indexes[q],s=f(e,r.keyPath);if(s)if(r.multiEntry&&s instanceof Array){for(var t={},u=0;u<s.length;u++)if(b(s[u])&&!t[s[u]]&&(t[s[u]]=s[u],r.unique&&r.__data[s[u]]))return m(c,n,{name:"ConstraintError"})}else{if(!b(s))continue;if(r.unique&&r.__data[s])return m(c,n,{name:"ConstraintError"})}}for(var v=0;v<c._indexes.length;v++){var w=c._indexes[v];if(!k)for(var x=0;x<w.__data.length;x++)for(var y=0;y<w.__data[x].length;y++)w.__data[x][y].key==j&&w.__data[x].splice(y,1);var z=f(e,w.keyPath);if(z)if(w.multiEntry&&z instanceof Array)for(var A={},B=0;B<z.length;B++)"number"!=typeof z[B]||A[z[B]]||(A[z[B]]=z[B],w.__data[z[B]]||(w.__data[z[B]]=[]),w.__data[z[B]].push({key:j,data:e}));else{if(!b(z))continue;w.__data[z]||(w.__data[z]=[]),w.__data[z].push({key:j,data:e})}}return k&&!c.__data[o]&&c.__keys.push(o),c.__data[o]=e,setTimeout(function(){"function"==typeof n.onsuccess&&(n.target=n,n.target.result=o,n.target.readyState="done",n.onsuccess(n)),c.__actions.splice(c.__actions.indexOf(l),1)},d),n}function r(a,b,c){if(this.transaction.mode!==g.VERSIONCHANGE&&p(this,{name:"InvalidStateError"}),b&&b instanceof Array)for(var d=0;d<b.length;d++)""===b[d]&&p(this,{name:"InvalidStateError"});var e=new n(a,b,c,this);return this._indexes.push(e),this.indexNames.push(a),e}function s(a){this.transaction.mode!==g.VERSIONCHANGE&&p(this,{name:"InvalidStateError"});for(var b=!1,c=0;c<this.indexNames.length;c++)this.indexNames[c]===a&&(this.indexNames.splice(c,1),b=!0);b||p(this,{name:"NotFoundError"});for(var d=0;d<this._indexes.length;d++)this._indexes[d].name===a&&this._indexes.splice(d,1)}function t(a){if(this.mode!==g.VERSIONCHANGE){for(var b=!1,c=0;c<this.indexNames.length;c++)this.indexNames[c]===a&&(b=!0);b||p(this,{name:"NotFoundError"})}for(var d=0;d<this._indexes.length;d++)if(this._indexes[d].name===a)return this._indexes[d].objectStore=this,this._indexes[d];p(this,{name:"NotFoundError"})}function u(){return 0===this.__actions.length}return{get:j,add:l,put:k,createIndex:r,deleteIndex:s,index:t,__finished:u}}(),n.prototype=function(){function a(){}return{get:a}}(),o.only=function(a){if(!b(a))throw{name:"DataError"};return new o(a,a,!1,!1)},o.lowerBound=function(a,c){if(!b(a))throw{name:"DataError"};return new o(a,void 0,c?c:!1,!0)},o.upperBound=function(a,c){if(!b(a))throw{name:"DataError"};return new o(void 0,a,!0,c?c:!1)},o.bound=function(a,c,d,e){if(!b(a)||!b(c)||a>c||c===a&&e&&d)throw{name:"DataError"};return new o(a,c,d?d:!1,e?e:!1)},o.prototype=function(){function a(a){return(!this.lower||a>this.lower||a===this.lower&&!this.lowerOpen)&&(!this.upper||a<this.upper||a===this.upper&&!this.upperOpen)?!0:!1}return{inRange:a}}(),a.indexedDBmock=f,a.IDBCursormock=m,a.IDBDatabasemock=j,a.IDBTransactionmock=k,a.IDBObjectStoremock=l,a.IDBRequestmock=l,a.IDBIndexmock=n,a.IDBKeyRangemock=o,a.indexedDBmockDbs=e}(window||self);